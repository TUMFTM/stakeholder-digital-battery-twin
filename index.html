<!doctype html>
<html>
 <head>
  <title>vis.js Graph demo</title>
  <link rel="stylesheet" type="text/css" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/p5"></script>
   <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

  <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet" type="text/css" />

    <style type="text/css">
        #mynetwork {
            width: 600px;
            height: 400px;
            border: 1px solid lightgray;
        }
    </style>

 </head>

 <body>
 <h1>Stakeholder Digital Battery Twin</h1>
 <p class="container_text">
  <b>Abstract</b><br>
  During the work on the below mentioned paper, a fair amount of data accumulated. Not all information made its way into the paper. To supplement the information and show the full database, we created this repository.<br>
  <br>
  In the below graph, we show the complete dataset including relations between stakeholders their interests and their actions. Furtheron, actions can have pre-actions which are mandatory in order to fulfill the first one.

  <br>
  <br>
  <b>Legend</b><br>
  light green: Stakeholders<br>
  dark green: Interests of the stakeholders<br>
  blue: Actions of the stakeholders<br>
  Stakeholders and their respective actions/interests are connected by dashed arows. Interests, Actions and pre-actions are connected using full arrows.
  <br>
  <br>
  <b>Technical University of Munich</b><br>
  <b>Authors:</b> Merkle, Moers<br>
  <b>DOI:</b> 10.123123.efgthrth<br>

 </p>

	 <label>
	  Filter nodes
	  <select id="nodeFilterSelect">
      <optgroup label="Relations">
  	    <option value>All</option>
        <option value="interests_sh">Interests and Stakeholders</option>
        <option value="actions_sh">Actions and Stakeholders</option>
        <option value="interests_actions">Interests and Actions</option>
      </optgroup>
      <optgroup label="Single Nodes">
        <option value="stakeholders">Only Stakeholders</option>
        <option value="actions">Only Actions</option>
        <option value="interests">Only Interests</option>
      </optgroup>
	  </select>
	</label>

	 <div id="graph", class="container_network"></div> 
	 <p class="container_text">
	 	We used <a href="https://visjs.org/">vis.js</a> to plot the network.
	 </p>
 <script type="text/javascript">

	
	// you can customize the result like with these options. These are explained below.
	// These are the default options.
	var parserOptions = {
	  edges: {
	    inheritColors: false
	  },
	  nodes: {
	    fixed: true,
	    parseColor: false
	  }
	}
	
	jQuery.get('Merged_Network.dot', function(data) {
  //jQuery.get('gephi_Merged_Network.json', function(data) {
		const nodeFilterSelector = document.getElementById("nodeFilterSelect");
		let nodeFilterValue = "";
		var DOTstring = data

    // Import data from DOT File
		var parsed = vis.parseDOTNetwork(DOTstring);
    //Import data from gephi json file
    //var parsed = vis.parseGephiNetwork(DOTstring, parserOptions);
		console.log(parsed)
		
		const nodesFilter = node => {
		  if (nodeFilterValue === "") {
		    return true;
		  }
		  switch (nodeFilterValue) {
		    case "stakeholders":
		      return node.type === "sh";
		    case "actions":
		      return node.type === "action";
		    case "interests":
		      return node.type === "interest";
	        case "interests_sh":
	          return (node.type === "interest" || node.type === "sh");
	        case "actions_sh":
	          return (node.type === "action" || node.type === "sh");
	        case "interests_actions":
	          return (node.type === "interest" || node.type === "action");

		    default:
		      return true;
		  }
		};
		
		//Setup datas

		// Change styling in the data
		n_nodes = parsed.nodes.length
		n_edges = parsed.nodes.length

		for (var i = 0; i < n_nodes; i++) {
		    console.log(parsed.nodes[i]);
		}

		//console.log(parsed.nodes)
		var nodesData = new vis.DataSet()
		nodesData.add(parsed.nodes);
		const nodesView = new vis.DataView(nodesData, { filter: nodesFilter });
    	console.log("Nodes View at start:")
		console.log(nodesView)

		// provide data in the normal fashion
		var data2 = {
		  //nodes: parsed.nodes,
		  nodes: nodesView,
		  edges: parsed.edges
		};
		
		nodeFilterSelector.addEventListener("change", e => {
		// set new value to filter variable
		nodeFilterValue = e.target.value;


		console.log("triggered!");
		nodesView.refresh();
		console.log("Nodes View after refresh:")
		console.log(nodesView)
		console.log("Nodes Filter Value:")
		console.log(nodeFilterValue)
		graph.redraw()
		});

		var options={
			nodes:{
				shape: "box"
			}
		};


		var container = document.getElementById('graph');
		var graph = new vis.Network(container, data2, options);
		graph.redraw()
		graph.setSize("1200", "800")
		
	});

  </script>
 </body>
</html>
