<!doctype html>
<html>
 <head>
  <title>vis.js Graph demo</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/p5"></script>
   <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

  <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet" type="text/css" />

    <style type="text/css">
        #mynetwork {
            width: 600px;
            height: 400px;
            border: 1px solid lightgray;
        }
    </style>

 </head>

 <body>
 <h1>VIS DEMO</h1>
	 <label>
	  Filter nodes
	  <select id="nodeFilterSelect">
	    <option value>All</option>
	    <option value="stakeholders">Stakeholders</option>
	    <option value="actions">Actions</option>
	    <option value="interests">Interests</option>
	  </select>
	</label>

	 <div id="graph"></div> 
 <script type="text/javascript">
	
	// you can customize the result like with these options. These are explained below.
	// These are the default options.
	var parserOptions = {
	  edges: {
	    inheritColors: false
	  },
	  nodes: {
	    fixed: true,
	    parseColor: false
	  }
	}
	
	jQuery.get('Merged_Network.dot', function(data) {
  //jQuery.get('gephi_Merged_Network.json', function(data) {
		const nodeFilterSelector = document.getElementById("nodeFilterSelect");
		let nodeFilterValue = "";
		var DOTstring = data

    // Import data from DOT File
		var parsed = vis.parseDOTNetwork(DOTstring);
    //Import data from gephi json file
    //var parsed = vis.parseGephiNetwork(DOTstring, parserOptions);
		console.log(parsed)
		
		const nodesFilter = node => {
		  if (nodeFilterValue === "") {
		    return true;
		  }
		  switch (nodeFilterValue) {
		    case "stakeholder":
		      return node.type === "sh";
		    case "action":
		      return node.type === "action";
		    case "interest":
		      return node.type === "interest";
		    default:
		      return true;
		  }
		};
		
		//Setup datas
		//console.log(parsed.nodes)
		var nodesData = new vis.DataSet()
		nodesData.add(parsed.nodes);
		const nodesView = new vis.DataView(nodesData, { filter: nodesFilter });
    console.log("Nodes View at start:")
		console.log(nodesView)

		// provide data in the normal fashion
		var data2 = {
		  //nodes: parsed.nodes,
		  nodes: nodesView,
		  edges: parsed.edges
		};
		
		nodeFilterSelector.addEventListener("change", e => {
		  // set new value to filter variable
		  nodeFilterValue = e.target.value;
		  /*
			refresh DataView,
			so that its filter function is re-calculated with the new variable
		      */
			
		  console.log("triggered!");
		  nodesView.refresh();
      console.log("Nodes View after refresh:")
      console.log(nodesView)
      console.log("Nodes Filter Value:")
      console.log(nodeFilterValue)
      graph.redraw()
		});
		
		var options={};



		var container = document.getElementById('graph');
		var graph = new vis.Network(container, data2, options);
		graph.redraw()
		graph.setSize("1200", "800")
		
	});

  </script>
 </body>
</html>
